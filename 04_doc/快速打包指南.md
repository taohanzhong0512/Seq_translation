# 🚀 快速打包指南

## 一、前提条件

### 必需软件
- ✅ Python 3.10+ 已安装
- ✅ pip 包管理器可用

### 检查方法
```bash
# 检查 Python
python --version

# 检查 pip
pip --version
```

---

## 二、5 分钟快速打包

### 步骤 1: 复制文件到正确位置

**创建以下目录结构：**
```
DCS_script/                          ← 任意位置创建
├── code/                            ← 代码文件夹
│   ├── seq_to_png_gui.py           ← 从 02_源代码 复制
│   ├── seq_to_png.py               ← 从 02_源代码 复制
│   ├── seq_converter.spec          ← 从 03_打包工具 复制
│   └── build_with_spec.bat         ← 从 03_打包工具 复制
└── image/                           ← 资源文件夹
    ├── DCS_Application_Logo.ico    ← 从 05_资源文件/image 复制
    ├── DCS_icon_multi.ico          ← 从 05_资源文件/image 复制
    └── SIOM_logo.png               ← 从 05_资源文件/image 复制
```

**快速复制命令：**
```bash
# 创建项目目录
mkdir DCS_script
cd DCS_script
mkdir code image

# 复制文件（根据实际路径调整）
cp SEQ_Converter_Release/02_源代码/* code/
cp SEQ_Converter_Release/03_打包工具/seq_converter.spec code/
cp SEQ_Converter_Release/03_打包工具/build_with_spec.bat code/
cp -r SEQ_Converter_Release/05_资源文件/image/* image/
```

### 步骤 2: 安装依赖

```bash
# 进入代码目录
cd code

# 安装 PyInstaller
pip install pyinstaller

# 或安装所有依赖
pip install -r ../SEQ_Converter_Release/03_打包工具/requirements_gui.txt
```

### 步骤 3: 执行打包

**方法一：双击批处理文件（最简单）**
```
双击: code/build_with_spec.bat
```

**方法二：命令行**
```bash
cd code
python -m PyInstaller seq_converter.spec --noconfirm
```

### 步骤 4: 获取结果

打包完成后：
```
code/
└── dist/
    └── SEQ_to_PNG_Converter.exe  ← 这就是最终产品！
```

**文件大小：** 约 91 MB

---

## 三、验证打包结果

### 1. 运行测试
```bash
cd dist
SEQ_to_PNG_Converter.exe
```

### 2. 检查清单
- ✅ 程序能正常启动
- ✅ 窗口标题栏有图标
- ✅ 界面右上角有 SIOM logo
- ✅ 选择 SEQ 文件功能正常
- ✅ 转换功能正常

---

## 四、常见错误及解决

### 错误 1: 找不到模块
```
ModuleNotFoundError: No module named 'xxx'
```

**解决：**
```bash
pip install xxx
```

### 错误 2: 找不到图标文件
```
Unable to find icon file
```

**解决：**
- 检查 `image` 文件夹是否在项目根目录
- 检查图标文件名是否正确

### 错误 3: spec 文件路径错误
```
Error: Path not found
```

**解决：**
- 确保目录结构正确
- 从 `code` 目录运行打包命令

### 错误 4: 权限被拒绝
```
PermissionError: [WinError 5]
```

**解决：**
- 关闭正在运行的 exe
- 删除 `dist` 和 `build` 文件夹
- 重新打包

---

## 五、高级选项

### 清理打包
```bash
# 清理后重新打包
python -m PyInstaller seq_converter.spec --clean --noconfirm
```

### 只更新代码（不清理）
```bash
# 快速重新打包
python -m PyInstaller seq_converter.spec --noconfirm
```

### 查看详细日志
```bash
# 显示详细信息
python -m PyInstaller seq_converter.spec --log-level=DEBUG
```

---

## 六、批量打包脚本

创建 `batch_build.bat`：
```batch
@echo off
echo ========================================
echo 批量打包 SEQ Converter
echo ========================================

echo [1/5] 清理旧文件...
if exist dist rmdir /s /q dist
if exist build rmdir /s /q build

echo [2/5] 检查依赖...
python -m pip install pyinstaller -q

echo [3/5] 开始打包...
python -m PyInstaller seq_converter.spec --noconfirm

echo [4/5] 验证结果...
if exist "dist\SEQ_to_PNG_Converter.exe" (
    echo ✓ 打包成功！
    echo.
    echo 文件位置: dist\SEQ_to_PNG_Converter.exe
    dir "dist\SEQ_to_PNG_Converter.exe"
) else (
    echo ✗ 打包失败！
    exit /b 1
)

echo [5/5] 完成！
pause
```

---

## 七、目录结构模板

**完整的工作目录：**
```
DCS_script/                          ← 项目根目录
├── code/                            ← 工作目录
│   ├── seq_to_png_gui.py           ← 源文件
│   ├── seq_to_png.py               ← 源文件
│   ├── seq_converter.spec          ← 配置文件
│   ├── build_with_spec.bat         ← 打包脚本
│   ├── build/                      ← 临时文件（自动生成）
│   └── dist/                       ← 输出目录（自动生成）
│       └── SEQ_to_PNG_Converter.exe
└── image/                           ← 资源目录
    ├── DCS_Application_Logo.ico
    ├── DCS_icon_multi.ico
    └── SIOM_logo.png
```

---

## 八、一键部署包

### 创建 setup_and_build.bat

```batch
@echo off
chcp 65001 > nul
cls

echo ╔════════════════════════════════════════╗
echo ║   SEQ Converter 一键部署和打包         ║
echo ╚════════════════════════════════════════╝
echo.

:: 检查目录结构
echo [1/6] 检查目录结构...
if not exist "image" (
    echo ✗ 错误: image 目录不存在
    echo 请确保 image 文件夹在项目根目录
    pause
    exit /b 1
)
echo ✓ 目录结构正确

:: 安装依赖
echo.
echo [2/6] 安装依赖...
python -m pip install --upgrade pip -q
python -m pip install pyinstaller -q
echo ✓ 依赖安装完成

:: 清理旧文件
echo.
echo [3/6] 清理旧文件...
if exist dist rmdir /s /q dist
if exist build rmdir /s /q build
echo ✓ 清理完成

:: 打包
echo.
echo [4/6] 开始打包...
python -m PyInstaller seq_converter.spec --noconfirm
if %errorlevel% neq 0 (
    echo ✗ 打包失败
    pause
    exit /b 1
)
echo ✓ 打包完成

:: 验证
echo.
echo [5/6] 验证结果...
if exist "dist\SEQ_to_PNG_Converter.exe" (
    echo ✓ 验证成功
    echo.
    echo 文件信息:
    dir "dist\SEQ_to_PNG_Converter.exe" | find "SEQ_to_PNG_Converter.exe"
) else (
    echo ✗ 未找到输出文件
    pause
    exit /b 1
)

:: 完成
echo.
echo [6/6] 完成！
echo.
echo ╔════════════════════════════════════════╗
echo ║        打包成功完成！                  ║
echo ╚════════════════════════════════════════╝
echo.
echo 输出文件: dist\SEQ_to_PNG_Converter.exe
echo.

choice /C YN /M "是否打开输出目录"
if errorlevel 2 goto :end
if errorlevel 1 start dist

:end
pause
```

---

## 九、打包检查清单

打包前检查：
- [ ] Python 已安装（3.10+）
- [ ] 目录结构正确
- [ ] 所有源文件已复制
- [ ] 所有资源文件已复制
- [ ] PyInstaller 已安装

打包后检查：
- [ ] dist 文件夹存在
- [ ] SEQ_to_PNG_Converter.exe 存在
- [ ] 文件大小约 91 MB
- [ ] 双击可以运行
- [ ] 界面图标正确显示

---

## 十、故障排除

### 问题：打包后运行报错

**调试步骤：**
1. 在命令行运行 exe，查看错误信息
2. 检查 `build/warn-*.txt` 文件
3. 确认所有依赖都在 spec 的 hiddenimports 中

### 问题：图标不显示

**检查：**
1. 图标文件是否存在于 image 目录
2. spec 文件中 datas 配置是否正确
3. 图标文件格式是否正确（多尺寸 .ico）

### 问题：缺少 qfluentwidgets 资源

**解决：**
```python
# 在 spec 文件中确保有：
hiddenimports=[
    'qfluentwidgets',
    'qfluentwidgets.common',
    'qfluentwidgets.components',
    'qfluentwidgets.window',
]
```

---

## 🎉 完成！

现在你已经掌握了完整的打包流程！

**记住：**
- 保持目录结构正确
- 确保所有依赖已安装
- 打包前先测试源代码
- 打包后全面测试 exe

---

*更新时间: 2025-11-10*
*难度等级: ⭐⭐ (简单)*
